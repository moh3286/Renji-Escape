<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Escape Coins</title>

<style>
body {
  margin: 0;
  background: #0f1115;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
}

.hidden { display: none; }

button {
  padding: 12px 18px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
  background: #1e90ff;
  color: white;
}

button:active { transform: scale(0.96); }

#menu, #shop {
  padding: 20px;
}

canvas {
  background: #111;
  border-radius: 14px;
  display: block;
  margin: 10px auto;
}

/* ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
#mobileControls {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

#mobileControls .row {
  display: flex;
  gap: 14px;
}

#mobileControls button {
  width: 64px;
  height: 64px;
  font-size: 26px;
  border-radius: 50%;
  background: #1e90ff;
  opacity: 0.85;
}
</style>
</head>

<body>

<!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
<div id="menu">
  <h1>ğŸ® Escape Coins</h1>
  <p>Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª ÙˆØ§Ù‡Ø±Ø¨ Ù…Ù† Ø§Ù„Ø¹Ø¯Ùˆ</p>
  <p>ğŸ’° Ø¹Ù…Ù„Ø§ØªÙƒ: <span id="wallet">0</span></p>
  <button onclick="startGame()">Ø§Ø¨Ø¯Ø£</button>
  <button onclick="openShop()">Ø§Ù„Ù…ØªØ¬Ø±</button>
</div>

<!-- Ø§Ù„Ù…ØªØ¬Ø± -->
<div id="shop" class="hidden">
  <h2>ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</h2>
  <p>Ø³ÙƒÙ† Ø£Ø²Ø±Ù‚ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</p>
  <p>Ø³ÙƒÙ† Ø£Ø®Ø¶Ø± â€“ Ø§Ù„Ø³Ø¹Ø± 30 ğŸ’°</p>
  <button onclick="buySkin()">Ø´Ø±Ø§Ø¡</button>
  <br><br>
  <button onclick="backToMenu()">Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- Ø§Ù„Ù„Ø¹Ø¨Ø© -->
<div id="gameScreen" class="hidden">
  <p>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></p>
  <canvas id="game" width="360" height="360"></canvas>
  <button onclick="exitGame()">Ø®Ø±ÙˆØ¬</button>
</div>

<!-- ØªØ­ÙƒÙ… Ø§Ù„Ù‡Ø§ØªÙ -->
<div id="mobileControls" class="hidden">
  <button data-key="up">â†‘</button>
  <div class="row" dir="ltr">
    <button data-key="left">â†</button>
    <button data-key="down">â†“</button>
    <button data-key="right">â†’</button>
  </div>
</div>

<script>
/* ====== Ø­ÙØ¸ ====== */
let wallet = Number(localStorage.getItem("wallet")) || 0;
let skin = localStorage.getItem("skin") || "blue";
document.getElementById("wallet").textContent = wallet;

/* ====== Ø¹Ù†Ø§ØµØ± ====== */
const menu = document.getElementById("menu");
const shop = document.getElementById("shop");
const gameScreen = document.getElementById("gameScreen");
const mobileControls = document.getElementById("mobileControls");
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

/* ====== ØªØ­ÙƒÙ… ====== */
const keys = { up:false, down:false, left:false, right:false };

document.addEventListener("keydown", e => {
  if(e.key === "ArrowUp") keys.up = true;
  if(e.key === "ArrowDown") keys.down = true;
  if(e.key === "ArrowLeft") keys.left = true;
  if(e.key === "ArrowRight") keys.right = true;
  if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();
});

document.addEventListener("keyup", e => {
  if(e.key === "ArrowUp") keys.up = false;
  if(e.key === "ArrowDown") keys.down = false;
  if(e.key === "ArrowLeft") keys.left = false;
  if(e.key === "ArrowRight") keys.right = false;
});

/* Ù„Ù…Ø³ */
document.querySelectorAll("#mobileControls button").forEach(btn=>{
  const k = btn.dataset.key;
  btn.addEventListener("touchstart",e=>{ e.preventDefault(); keys[k]=true; });
  btn.addEventListener("touchend",e=>{ e.preventDefault(); keys[k]=false; });
});

/* ====== Ø§Ù„Ù„Ø¹Ø¨Ø© ====== */
let player, enemy, coin, score, running=false;

function resetGame(){
  player = {x:180,y:180,r:10,speed:3};
  enemy  = {x:40,y:40,s:14,speed:1.2};
  coin   = {x:100,y:100,r:6};
  score = 0;
  scoreEl.textContent = 0;
}

function startGame(){
  menu.classList.add("hidden");
  shop.classList.add("hidden");
  gameScreen.classList.remove("hidden");
  mobileControls.classList.remove("hidden");
  resetGame();
  running = true;
  loop();
}

function exitGame(){
  running = false;
  gameScreen.classList.add("hidden");
  mobileControls.classList.add("hidden");
  menu.classList.remove("hidden");
  document.getElementById("wallet").textContent = wallet;
}

function openShop(){
  menu.classList.add("hidden");
  shop.classList.remove("hidden");
}

function backToMenu(){
  shop.classList.add("hidden");
  menu.classList.remove("hidden");
}

function buySkin(){
  if(wallet < 30){ alert("Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ©"); return; }
  wallet -= 30;
  skin = "green";
  localStorage.setItem("wallet",wallet);
  localStorage.setItem("skin",skin);
  alert("ØªÙ… Ø´Ø±Ø§Ø¡ Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø£Ø®Ø¶Ø±");
}

function newCoin(){
  coin.x = Math.random()*340+10;
  coin.y = Math.random()*340+10;
}

function collideCircle(a,b){
  return Math.hypot(a.x-b.x,a.y-b.y) < a.r+b.r;
}

function collideEnemy(){
  return Math.abs(player.x-enemy.x)<14 && Math.abs(player.y-enemy.y)<14;
}

function loop(){
  if(!running) return;

  if(keys.up) player.y -= player.speed;
  if(keys.down) player.y += player.speed;
  if(keys.left) player.x -= player.speed;
  if(keys.right) player.x += player.speed;

  player.x = Math.max(10,Math.min(350,player.x));
  player.y = Math.max(10,Math.min(350,player.y));

  enemy.x += enemy.speed*Math.sign(player.x-enemy.x);
  enemy.y += enemy.speed*Math.sign(player.y-enemy.y);

  if(collideCircle(player,coin)){
    score++;
    wallet++;
    enemy.speed += 0.05;
    scoreEl.textContent = score;
    localStorage.setItem("wallet",wallet);
    newCoin();
  }

  if(collideEnemy()){
    alert("ğŸ’€ Ø®Ø³Ø±Øª! Ù†Ù‚Ø§Ø·Ùƒ: "+score);
    exitGame();
    return;
  }

  ctx.clearRect(0,0,360,360);

  ctx.fillStyle="lime";
  ctx.beginPath();
  ctx.arc(coin.x,coin.y,coin.r,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="red";
  ctx.fillRect(enemy.x,enemy.y,14,14);

  ctx.fillStyle = skin==="green" ? "lime" : "deepskyblue";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();

  requestAnimationFrame(loop);
}
</script>

</body>
</html>
